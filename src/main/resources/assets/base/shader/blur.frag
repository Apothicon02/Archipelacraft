uniform vec2 dir;
uniform ivec2 res;

uniform layout(binding = 0) sampler2D in_color;
uniform layout(binding = 1, rgba32f) image2D out_color;

in vec4 gl_FragCoord;

const int SAMPLE_COUNT = 33;

const float OFFSETS[33] = float[33](
-31.469286736558313,
-29.47123242536565,
-27.47317899449017,
-25.47512636609167,
-23.477074464275574,
-21.479023217336046,
-19.48097256045373,
-17.48292243861854,
-15.484872809220015,
-13.486823643156157,
-11.488774922273269,
-9.490726629154937,
-7.4926787222117985,
-5.494631083814344,
-3.496583420392626,
-1.4985350785178282,
0.4995108475675555,
2.497559396787363,
4.49560728468456,
6.4936548820396585,
8.491702632112665,
10.489750723839654,
12.487799227975632,
14.48584816959321,
16.48389756449537,
18.481947435633163,
20.479997818839735,
22.478048763192906,
24.47610032897032,
26.474152584794115,
28.472205604776082,
30.47025946603214,
32
);

const float WEIGHTS[33] = float[33](
0.007511267323995957,
0.009529358206818446,
0.011902457707149388,
0.014636330905107704,
0.01771945866286574,
0.021119881086850978,
0.024783089135808428,
0.02863139616790479,
0.03256513329120959,
0.036465862320876806,
0.04020159943354275,
0.04363381308067504,
0.046625731276220134,
0.0490512997377001,
0.05080400553652312,
0.05180474530908262,
0.05200740417415986,
0.05140206146781018,
0.05001742902491179,
0.047916523120622175,
0.04519304477777762,
0.04196433980540806,
0.038362952013387616,
0.03452762957555667,
0.030594600170979695,
0.026689846956663772,
0.022922953536475676,
0.019382870802003963,
0.01613572543808854,
0.013224571453177684,
0.010670808596672063,
0.008476871774077918,
0.0035249381298951476
);

void main() {
    vec4 result = vec4(0.0);
    for (int i = 0; i < SAMPLE_COUNT; ++i) {
        vec2 offset = dir * OFFSETS[i];
        float weight = WEIGHTS[i];
        ivec2 samplePos = ivec2(clamp(gl_FragCoord.xy + offset, vec2(0), res-1));
        vec4 newResult = texelFetch(in_color, samplePos, 0);
        result += newResult * weight;
    }
    imageStore(out_color, ivec2(gl_FragCoord.xy), result);
}